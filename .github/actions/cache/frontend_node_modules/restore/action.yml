name: "Restore frontend node-modules"
description: "Restore the npm install cache"
inputs:
  cache_version:
    description: "Version of the cache"
    required: true
outputs:
  cache_hit:
    description: "Cache hit"
    value: ${{ steps.restore.outputs.cache-hit }}

runs:
  using: "composite"
  steps:
    - name: Restore frontend node_modules
      id: restore
      uses: actions/cache/restore@5a3ec84eff668545956fd18022155c47e93e2684 # v4.2.3
      with:
        path: /tmp/npm_install
        key: frontend-npm-install-${{ inputs.cache_version }} branch:${{ github.head_ref || github.ref_name }} dependencies:${{ hashFiles('apps/package-lock.json', 'token-standard/package-lock.json', 'openapi-cache-key.txt', 'project/BuildCommon.scala') }} rev:${{ github.sha }}
        restore-keys: |
          frontend-npm-install-${{ inputs.cache_version }} branch:${{ github.head_ref || github.ref_name }} dependencies:${{ hashFiles('apps/package-lock.json', 'token-standard/package-lock.json', 'openapi-cache-key.txt', 'project/BuildCommon.scala') }}
          frontend-npm-install-${{ inputs.cache_version }} branch:main dependencies:${{ hashFiles('apps/package-lock.json', 'token-standard/package-lock.json', 'openapi-cache-key.txt', 'project/BuildCommon.scala') }}
    - name: Extracting archive of npm dependencies
      shell: bash
      run: |
        if [[ -e /tmp/npm_install ]]; then
          tar --use-compress-program=pigz -xf /tmp/npm_install/node_modules.tar.gz
          tar --use-compress-program=pigz -xf /tmp/npm_install/openapi-ts-client.tar.gz
        else
          echo "No npm install cache found. Skipping..."
        fi
