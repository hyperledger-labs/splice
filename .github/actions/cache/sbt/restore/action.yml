name: "Restore SBT Cacht"
description: "Restore the SBT cache"
inputs:
  cache_version:
    description: "Version of the cache"
    required: true
  splice_repo_path:
    description: "Path to splice repo"
    default: ${{ github.repository == 'hyperledger-labs/splice' && '.' || 'splice' }}
outputs:
  cache_hit:
    description: "Cache hit"
    value: ${{ steps.restore.outputs.cache-hit }}

runs:
  using: "composite"
  steps:
    - name: Restore SBT cache
      id: restore
      uses: actions/cache/restore@5a3ec84eff668545956fd18022155c47e93e2684 # v4.2.3
      with:
        path: |
          /github/home/.ivy2/cache
          /github/home/.sbt
        key: sbt-${{ inputs.cache_version }} job=${{ github.job }} dependencies=${{ hashFiles(format('{0}/project/Dependencies.scala', inputs.splice_repo_path), format('{0}/project/CantonDependencies.scala', inputs.splice_repo_path)) }}-${{ hashFiles(format('{0}/project/BuildCommon.scala', inputs.splice_repo_path), format('{0}/project/build.properties', inputs.splice_repo_path), format('{0}/project/Houserules.scala', inputs.splice_repo_path), format('{0}/project/plugins.sbt', inputs.splice_repo_path), format('{0}/build.sbt', inputs.splice_repo_path)) }}
        restore-keys: |
          sbt-${{ inputs.cache_version }} job=${{ github.job }} dependencies=${{ hashFiles(format('{0}/project/Dependencies.scala', inputs.splice_repo_path), format('{0}/project/CantonDependencies.scala', inputs.splice_repo_path)) }}
