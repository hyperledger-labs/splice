name: test
on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  test:
    runs-on: ubuntu-24.04
    steps:
      - name: direct test
        shell: bash
        run: |
          mkdir test
          cd test
          curl https://storage.googleapis.com/splice-nix-cache-public/48461acabd81ff985f7de6e4a32efb29.tar.gz -o b.tar.gz

      - name: test zstd
        shell: bash
        run: |
          cd test
          ls -l b.tar.gz
          echo "Extracting b.tar.gz"
          tar -xzf b.tar.gz
          echo "Done extracting b.tar.gz"
          rm b.tar.gz
          echo "Creating a.tar.zst"
          tar -I zstd -cf a.tar.zst *
          echo "Done creating a.tar.zst"
          ls -l a.tar.zst
          mkdir ../temp2
          mv a.tar.zst ../temp2/
          cd ..
          rm -rf test
          cd temp2
          echo "Extracting a.tar.zst"
          tar -I zstd -xf a.tar.zst
          echo "Done extracting a.tar.zst"
          ls -l
